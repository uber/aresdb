language: go
sudo: required
go:
    - "1.9"
env:
  global:
    - CUDA_VERSION="10.0"
    - CUDA_PKG_VERSION="130-1"
    - CUDA_PKG=cuda-repo-ubuntu1404_${CUDA_VERSION}.${CUDA_PKG_VERSION}_amd64.deb
    - CUDA_HOME=/usr/local/cuda
    - PATH=${PATH}:${CUDA_HOME}/bin:${GOPATH}/bin
    - LD_LIBRARY_PATH=${CUDA_HOME}/lib:${TRAVIS_HOME}/gopath/src/github.com/uber/aresdb/lib
    - GTEST_ROOT=./build/googletest
    # coverall token COVERALLS_TOKEN
    - secure: "nPYBfMqQjw3bzc84bXcN6FnNH52Zha060cRrPa6kUM1R2WiR+YYgOdMxE+OCglvqi6c4ykktHqh5T8+hM6VQzIrtEGMu4WMhrOrNrBCWHB4t2+7Fo5/reADW9WxqakWomvHbNQZmJB+OMl1qYtmkwo8Dy2NnyUX0tmC+04cnINk0naAmp/wTMbMvf3IDPZmFsROTBl+d37y/dfb4MvpHLtj7xMYZi3UmFqvbnIfWGknd64uLf/NX/+cRHXEsKIWgS7F5uD3ptFepbEpZqJ28QAUeLsSg24FTroDxmkQvpFwytbC5ByAesb3SMOY7nky5ZUpK8mz0mJaKLQK8f5TR4eFU4kxnJ+69InsQhKqRB4HvJWwjB9auMY6v/KYWq+nkGxlyAtIeN1rFrOksIuEIZVIJyCHrziVBnoCvrt6rPecsEHkZIisruIQhiu0c1ywrfOUye9y/4q2nMZYZ/eEkuHGfjL+FKO2wiqM1Ew4ATdeP7GWO+4ACNVXwR6kdAM9hP5lTbSnIQOxYmHVktjkuPY6BYmPVcnKZvWT9VfDKgXTNSunSCxCPwgoP6Uc0fRyvqGmo2MM2InmYnawkSxZsiRKr7BL1QIY5ly3dMP++kMkeM4j2EuvC3lUvtr06d+k/5AxzWfpkwHJIzhPNDlMqYix7v7ef2ejtNqUGPK3lt94="
    # codecov token CODECOV_TOKEN
    - secure: "k2bo3dEOvYB3tgOlzvcq0U4wA94QDMg3jjohK+fo8K8Vv/5ivSeT2X0mVMvPAWgwBExzsh5/IQa0rZvyXPh7BaVGeCVqR2cl2mEWto7zrwGP95TOKxTVfKt+XwHV98Exzlz/K8Jv/Yp0EM9zZXoevdQLO6JvpBASJKi3I17W+YY3UDctz2oP5DKwnT2EwpGQK0j+U95+qShgoNfBiNs4h6pAsiZ0Lg/A7a57hiAzcXGyWKAoFIV8kX0MGCFHoMqD5M5ZGv+JTR3der8RcqnnmxzkYdsqmAQQ2QTex4jziY7cLFS/NFNk6nPK0xFY/BVuQQYhwLqGd1unEJevzmPztfWwI8mEvS9FKhl3LVxYdUGxmpieKDA8tw+rN1RR91RzZW0896xsZQEWwjpAugaLKYTGpcQlvotolG76IIlcJlCacd1mg7E/iiVfRDesyKzKGTocFZUPhLoLAMt7frj+pKR2nU1Yu+7nzv/FXWCtssZBXI81JRmuUSIne3yI1ciJPuRpRngoyxd5KNdlbARsi1WBVYSFNySsiB9de7TAZvnkiimK+tzE0CNJ5OvJH+U/6dNCmDunE5lFn0Jcs6oSFmtyQuWGJvFljcQ2U7qUM3a6If82sNRY9/0naotO1ABRZbg7MNQGdGLmpeoYNYKsL82gX5JgcC4OVjupEzP1+dA="
cache: 
  directories:
    - lib
    - gtest

# safelist
branches:
  only:
    - master
install:
  - .travis/install_cuda.sh
  - .travis/install_golang_tools.sh
  - .travis/install_clang_tools.sh
script:
  - make lint
  - make travis
after_success:
  - rm query/expr/expr.coverprofile
  - gover . coverage.out
  - head coverage.out
  - goveralls -coverprofile=coverage.out -service=travis-ci -repotoken $COVERALLS_TOKEN
  - goveralls -coverprofile=coverage.out -service=travis-ci -repotoken xKiEh57SohfELSQf4MMeszxjokApeHwOI
  - mv coverage.out coverage.txt
  - bash <(curl -s https://codecov.io/bash)
after_script:
  - .travis/cleanup.sh
